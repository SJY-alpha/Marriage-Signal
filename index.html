<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>결혼시그널 제작소 v2.4 - AI Expert System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- MP3 인코딩 및 ZIP 압축 라이브러리 추가 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lamejs@1.2.1/lame.min.js"></script>

    <!-- 모듈화된 CSS 파일을 안정적인 CDN 주소로 불러옵니다. -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/SJY-alpha/Marriage-Signal@c6c8481392c24d61b0465131b38743e63424fdd9/style.css">
</head>
<body class="p-4 md:p-8">

    <div id="app" class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white tracking-wider">💍 결혼시그널 제작소 <span class="text-lg align-middle text-gray-400">v2.4</span> 💍</h1>
            <p class="text-gray-400 mt-2">결혼, 그 현실적인 이야기를 AI와 함께 쇼츠 드라마로 만들어보세요.</p>
        </header>

        <!-- 초기 설정 섹션 -->
        <section id="initial-settings" class="bg-gray-800 p-6 rounded-xl shadow-lg mb-8">
             <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                 <!-- 왼쪽 설정 영역 -->
                 <div>
                     <label for="keywords" class="block text-sm font-medium text-gray-300 mb-2">주제 키워드</label>
                     <input type="text" id="keywords" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-white focus:ring-2 focus:ring-indigo-500" placeholder="예: 시댁 갈등, 육아 문제" value="결혼 1년차, 와이프의 남사친 문제">
                    
                     <div class="grid grid-cols-2 gap-4 mt-4">
                          <div>
                             <label for="duration" class="block text-sm font-medium text-gray-300 mb-2">영상 길이 (초)</label>
                             <input type="number" id="duration" value="60" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-white focus:ring-2 focus:ring-indigo-500">
                         </div>
                          <div>
                             <label for="target-age" class="block text-sm font-medium text-gray-300 mb-2">타겟 연령층</label>
                             <select id="target-age" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-white focus:ring-2 focus:ring-indigo-500">
                                 <option>전체 연령</option>
                                 <option>20대</option>
                                 <option selected>30-40대</option>
                                 <option>50대 이상</option>
                             </select>
                         </div>
                     </div>
                      <div class="mt-4">
                         <span class="block text-sm font-medium text-gray-300 mb-2">이미지 비율</span>
                         <div class="flex items-center space-x-4 bg-gray-700 rounded-md p-2 h-full">
                             <label class="flex items-center space-x-2 cursor-pointer">
                                 <input type="radio" name="aspect-ratio" value="9:16" class="form-radio text-indigo-600 bg-gray-900" checked>
                                 <span>9:16 (세로)</span>
                             </label>
                         </div>
                     </div>
                 </div>
                 <!-- 오른쪽 대본 입력 영역 -->
                 <div>
                     <div class="flex justify-between items-center mb-2">
                         <label for="script-input" class="block text-sm font-medium text-gray-300">대본/사연 입력</label>
                         <button id="improve-script-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-1 px-3 rounded-lg text-sm transition-colors" title="입력된 대본을 AI가 더 흥미롭게 개선합니다.">
                             <i class="fas fa-wand-magic-sparkles mr-1"></i> AI 대본 개선
                         </button>
                     </div>
                     <textarea id="script-input" class="w-full h-56 bg-gray-700 border-gray-600 rounded-md p-2 text-white focus:ring-2 focus:ring-indigo-500" placeholder="결혼 생활의 갈등, 고민, 에피소드 등 실제 사연이나 대본을 입력하면 AI가 쇼츠 영상으로 재구성합니다. (상세할수록 퀄리티가 높아집니다)"></textarea>
                 </div>
             </div>
             <div class="mt-6 text-center">
                 <button id="generate-story-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition-transform transform hover:scale-105 shadow-lg" title="입력된 정보로 전체 쇼츠 드라마 시나리오를 생성합니다.">
                     <i class="fas fa-magic mr-2"></i> 시나리오 생성
                 </button>
             </div>
        </section>

        <!-- 로딩 인디케이터 -->
        <div id="loading-indicator" class="hidden flex-col items-center justify-center text-center my-10">
            <div class="loading-spinner mx-auto"></div>
            <p id="loading-message" class="mt-4 text-lg text-gray-300">AI가 시나리오를 생성중입니다... 🚀</p>
        </div>

        <!-- 메인 편집기 영역 -->
        <main id="editor-section" class="hidden">
             <div class="flex justify-between items-center mb-4 sticky-tabs">
                 <div class="flex space-x-2 border border-gray-700 rounded-lg p-1">
                     <button data-tab="reference-editor" class="tab-button active font-semibold py-2 px-4 rounded-md transition-colors" title="캐릭터, 배경 등 시각적 요소를 편집합니다."><i class="fas fa-images mr-2"></i>레퍼런스 편집기</button>
                     <button data-tab="timeline-editor" class="tab-button font-semibold py-2 px-4 rounded-md transition-colors" title="컷, 대사, 음성 등 시간 순서에 따라 편집합니다."><i class="fas fa-film mr-2"></i>타임라인 편집기</button>
                 </div>
                 <div class="flex space-x-2">
                     <button id="save-project-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-colors" title="현재 작업 내용을 파일로 저장합니다."><i class="fas fa-save mr-2"></i>저장</button>
                     <button id="load-project-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors" title="저장된 프로젝트 파일을 불러옵니다."><i class="fas fa-folder-open mr-2"></i>불러오기</button>
                     <input type="file" id="file-loader" class="hidden" accept=".json">
                 </div>
             </div>
            <h2 id="scenario-title" class="text-2xl font-bold text-center mb-4"></h2>
            
            <!-- 레퍼런스 편집기 -->
            <div id="reference-editor" class="tab-content bg-gray-800 p-6 rounded-xl shadow-lg">
                <div class="mb-8">
                     <h3 class="text-xl font-bold mb-3 border-l-4 border-indigo-500 pl-3">나레이션 성우</h3>
                     <div id="narrator-controls" class="bg-gray-700 p-4 rounded-lg">
                         <div class="flex items-center space-x-4 mb-2">
                             <select id="narrator-voice" class="bg-gray-600 p-2 rounded-md flex-grow" title="나레이션 목소리를 선택합니다."></select>
                             <button id="narrator-voice-preview" class="bg-blue-600 hover:bg-blue-700 p-2 rounded-md" title="선택된 목소리를 미리 들어봅니다."><i class="fas fa-play"></i></button>
                             <button id="narrator-apply-all" class="bg-teal-600 hover:bg-teal-500 p-2 rounded-md text-sm" title="현재 설정을 모든 나레이션에 적용"><i class="fas fa-check-double mr-1"></i> 전체 적용</button>
                         </div>
                         <div class="grid grid-cols-2 gap-x-4 text-sm">
                             <div>
                                 <label class="text-gray-400">피치: <span id="narrator-pitch-value">0.00</span></label>
                                 <input type="range" id="narrator-pitch-slider" class="w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer" min="-2.0" max="2.0" step="0.01" value="0.0" title="목소리 높낮이 조절">
                             </div>
                             <div>
                                 <label class="text-gray-400">속도: <span id="narrator-speed-value">1.00</span></label>
                                 <input type="range" id="narrator-speed-slider" class="w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer" min="0.45" max="1.85" step="0.01" value="1.0" title="말하기 속도 조절">
                             </div>
                         </div>
                     </div>
                 </div>
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-3 border-l-4 border-indigo-500 pl-3">등장인물</h3>
                    <div id="character-references" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
                </div>
                <div>
                     <div class="flex items-center mb-3">
                         <h3 class="text-xl font-bold border-l-4 border-indigo-500 pl-3">배경</h3>
                         <div id="background-tabs" class="ml-4 flex space-x-1"></div>
                     </div>
                    <div id="background-references" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
                </div>
            </div>

            <!-- 타임라인 편집기 -->
            <div id="timeline-editor" class="tab-content hidden bg-gray-800 p-6 rounded-xl shadow-lg">
                <div class="flex items-center justify-center space-x-4 mb-6 bg-gray-900 p-3 rounded-lg sticky top-20 z-10">
                    <button id="timeline-play" class="text-2xl text-green-400 hover:text-green-300" title="타임라인 전체 재생"><i class="fas fa-play-circle"></i></button>
                    <button id="timeline-pause" class="hidden text-2xl text-yellow-400 hover:text-yellow-300" title="일시정지"><i class="fas fa-pause-circle"></i></button>
                    <button id="timeline-stop" class="text-2xl text-red-400 hover:text-red-300" title="정지 및 처음으로"><i class="fas fa-stop-circle"></i></button>
                    <div class="flex items-center text-lg ml-4">
                        <span id="current-time">0.0</span>s / <span id="total-time">0.0</span>s
                    </div>
                    <div class="flex items-center ml-auto space-x-4">
                        <button id="download-all-audio-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded-lg text-sm transition-colors" title="모든 대사 음성을 MP3 파일로 압축하여 저장합니다."><i class="fas fa-archive mr-2"></i>모든 음성 저장</button>
                        <div>
                            <input type="checkbox" id="show-subtitles" class="form-checkbox text-indigo-500 bg-gray-700" checked>
                            <label for="show-subtitles" class="ml-2">대사 표시</label>
                        </div>
                    </div>
                </div>
                <div id="timeline-container" class="space-y-6"></div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="image-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop">
        <div class="bg-gray-900 rounded-lg shadow-xl p-4 max-w-4xl max-h-[90vh] flex flex-col">
            <img id="modal-image" src="" class="max-w-full max-h-[80vh] object-contain mx-auto rounded">
            <div class="flex justify-end space-x-2 mt-3">
                <span id="modal-info" class="text-gray-400 mr-auto self-center"></span>
                <button id="modal-flip" class="bg-gray-600 text-white px-4 py-2 rounded-md"><i class="fas fa-arrows-alt-h mr-2"></i>수평 뒤집기</button>
                <button id="modal-download" class="bg-blue-600 text-white px-4 py-2 rounded-md"><i class="fas fa-download mr-2"></i>다운로드</button>
                <button id="modal-close" class="bg-red-600 text-white px-4 py-2 rounded-md">닫기</button>
            </div>
        </div>
    </div>
    <div id="prompt-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop"><div class="bg-gray-800 rounded-lg shadow-xl p-6 w-1/2 flex flex-col"><h4 id="prompt-modal-title" class="text-xl font-bold mb-4">프롬프트 편집</h4><div id="prompt-modal-editor" class="w-full h-48 bg-gray-700 p-2 rounded text-white mb-4 overflow-y-auto" contenteditable="true"></div><div id="translation-container" class="hidden w-full h-24 bg-gray-900 p-2 rounded text-gray-300 mb-4 overflow-y-auto"></div><div class="flex justify-end space-x-2"><button id="prompt-modal-cancel" class="bg-gray-600 text-white px-4 py-2 rounded-md">취소</button><button id="prompt-modal-save" class="bg-indigo-600 text-white px-4 py-2 rounded-md">저장</button></div></div></div>
    <div id="personality-modal" class="fixed inset-0 z-[51] hidden items-center justify-center modal-backdrop">
        <div class="bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-3xl flex flex-col">
            <div class="flex justify-between items-center mb-4">
                 <h4 id="personality-modal-title" class="text-xl font-bold">성격 편집</h4>
                 <span id="personality-selected-count" class="text-sm text-gray-400 font-bold">0/5 선택됨</span>
            </div>
            <div class="flex border-b border-gray-700 mb-4">
                <div id="personality-category-tabs" class="flex space-x-1">
                    <!-- Category tabs will be inserted here -->
                </div>
            </div>
            <div id="personality-tags-container" class="flex flex-col gap-3 mb-4 max-h-64 overflow-y-auto pr-2">
                 <!-- Tags for the active category will be inserted here -->
            </div>
            <div class="flex justify-end items-center space-x-2 mt-4">
                <button id="personality-modal-cancel" class="bg-gray-600 text-white px-4 py-2 rounded-md">취소</button>
                <button id="personality-modal-save" class="bg-indigo-600 text-white px-4 py-2 rounded-md" disabled>저장</button>
            </div>
        </div>
    </div>
    <!-- Video Player Modal -->
    <div id="video-player-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop">
        <div class="bg-black rounded-lg shadow-xl w-full max-w-md aspect-[9/16] flex flex-col relative overflow-hidden">
            <img id="player-image" src="" class="w-full h-full object-cover">
            <div id="player-subtitles-container"></div>
            <button id="player-close" class="absolute top-2 right-2 text-white bg-black bg-opacity-50 rounded-full w-8 h-8 flex items-center justify-center">&times;</button>
        </div>
    </div>

    <!-- Mention Dropdown -->
    <div id="mention-dropdown" class="absolute z-50 hidden bg-gray-700 border border-gray-600 rounded-md shadow-lg max-h-48 overflow-y-auto"></div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="fixed inset-0 z-[52] hidden items-center justify-center modal-backdrop">
        <div class="bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm flex flex-col">
            <h4 id="confirm-modal-title" class="text-lg font-bold mb-4">확인</h4>
            <p id="confirm-modal-message" class="text-gray-300 mb-6">이 작업을 계속하시겠습니까?</p>
            <div class="flex justify-end space-x-2">
                <button id="confirm-modal-cancel" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-md">취소</button>
                <button id="confirm-modal-confirm" class="bg-red-600 hover:bg-red-500 text-white px-4 py-2 rounded-md">확인</button>
            </div>
        </div>
    </div>
    <!-- Toast Notification Container -->
    <div id="toast-container" class="fixed top-8 right-8 z-[100] space-y-2"></div>
    
    <!-- [DEBUG] On-screen TTS Debug Console -->
    <div id="tts-debug-console" class="fixed bottom-0 left-0 right-0 h-48 bg-black bg-opacity-90 text-white p-2 text-xs font-mono z-[200] flex flex-col hidden">
        <div class="flex justify-between items-center pb-1 border-b border-gray-600 flex-shrink-0">
            <h5 class="font-bold">🎤 TTS 디버그 콘솔</h5>
            <div>
                <button id="clear-tts-console-btn" class="bg-gray-600 hover:bg-gray-500 px-2 py-0.5 rounded text-xs mr-2">Clear</button>
                <button id="close-tts-console-btn" class="bg-red-600 hover:bg-red-500 px-2 py-0.5 rounded text-xs">Close</button>
            </div>
        </div>
        <div id="tts-debug-output" class="flex-grow overflow-y-auto mt-1"></div>
    </div>
    <button id="show-tts-console-btn" class="fixed bottom-4 right-4 bg-purple-600 text-white rounded-full w-12 h-12 flex items-center justify-center z-[199] shadow-lg"><i class="fas fa-microphone-alt"></i></button>

    <!--
        애플리케이션의 메인 스크립트 파일을 불러옵니다.
        이 파일은 다른 모든 JS 모듈들을 가져와서 앱을 실행하는 역할을 합니다.
    -->
    <script type="module" src="https://cdn.jsdelivr.net/gh/SJY-alpha/Marriage-Signal@c6c8481392c24d61b0465131b38743e63424fdd9/js/main.js"></script>
</body>
</html>

